<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voting System - Google Sheets Sync</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Prompt', sans-serif; background: linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%); min-height: 100vh; color: white; }
    .candidate-card { transition: all 0.2s; border: 2px solid transparent; cursor: pointer; }
    .candidate-card.selected { border-color: #10b981; background: rgba(16, 185, 129, 0.1); transform: translateY(-5px); }
    .fade-in { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="p-4 md:p-8">

  <div id="app" class="max-w-4xl mx-auto">
    <div class="flex justify-end mb-6">
      <button onclick="toggleLang()" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full border border-white/20 text-sm transition-all">
        <span id="lang-btn-text">English</span> üåê
      </button>
    </div>

    <div id="screen-voting" class="fade-in">
      <header class="text-center mb-10">
        <h1 id="txt-title" class="text-3xl font-bold mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö</h1>
        <p id="txt-subtitle" class="text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 3 ‡∏Ñ‡∏ô</p>
      </header>

      <div class="max-w-md mx-auto mb-10 text-center">
        <input type="email" id="input-email" oninput="validate()" 
               class="w-full px-6 py-4 rounded-2xl bg-white/10 border border-white/20 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-400 transition-all text-center text-lg" 
               placeholder="yourname@example.com">
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-10" id="grid-candidates">
        </div>

      <div class="text-center sticky bottom-10">
        <button id="btn-submit" disabled onclick="submitData()" 
                class="px-12 py-4 rounded-full text-xl font-bold bg-emerald-500 hover:bg-emerald-400 disabled:opacity-30 disabled:cursor-not-allowed shadow-xl transition-all">
          <span id="txt-btn-submit">‡∏™‡πà‡∏á‡πÇ‡∏´‡∏ß‡∏ï</span> ( <span id="count-display">0</span>/3 )
        </button>
        <p id="txt-hint" class="text-sm mt-3 text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 3 ‡∏Ñ‡∏ô</p>
      </div>
    </div>

    <div id="screen-loading" class="hidden text-center py-20 fade-in">
      <div class="w-16 h-16 border-4 border-emerald-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
      <p id="txt-loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets...</p>
    </div>

    <div id="screen-success" class="hidden text-center py-20 fade-in">
      <div class="text-6xl mb-6">‚úÖ</div>
      <h2 id="txt-success-title" class="text-3xl font-bold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</h2>
      <p id="txt-success-desc" class="text-gray-400 mb-8">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>
      <div class="bg-white/5 p-4 rounded-xl inline-block text-sm">
        Email: <span id="display-email" class="text-emerald-400"></span>
      </div>
    </div>

    <div id="screen-already" class="hidden text-center py-20 fade-in">
      <div class="text-6xl mb-6">üö´</div>
      <h2 id="txt-already-title" class="text-3xl font-bold mb-4">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</h2>
      <p id="txt-already-desc" class="text-gray-400">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß</p>
    </div>
  </div>

  <script>
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwNQcRJjYV_j1CVHnLa-DVBye8J9dQM4CcpSAeMORJ9_uVsBhYFnxvvMNxmwiCRtjwKXg/exec";

    const candidates = [
    { id: 1, name: 'Neo (Touchphoom Anantakarn)'},
    { id: 2, name: 'Meg (Mira Hsu)'},
    { id: 3, name: 'Kin (Pakin Hsu)'},
    { id: 4, name: 'Marvin (Apipoom Hanjawanich)'},
    { id: 5, name: 'Pete (PITCHAYUT KRUECHOTEKUL)'},
    { id: 6, name: 'JulJul (Saranyapong Kanchanapangka)'},
    { id: 7, name: 'Etienne (Tiberghien)'},
    { id: 8, name: 'Aiden (Kritchanon Sivasri)'},
    { id: 9, name: 'Tyler (Tyler Saebae)'},
    { id: 10, name: 'Nine (Paratham Jameeken)'},
    { id: 11, name: 'Nuermek (Nuermek Teeraakararat)'},
    { id: 12, name: 'Preme2 (Premephaphan Ittipunsiri)'},
    { id: 13, name: 'Gin (Sasawat Lertsamart)'},
    { id: 14, name: 'Famous (Yannavut Sridawong)'},
    { id: 15, name: 'Tonmai (Nathakorn Somsanguan)'},
    { id: 16, name: 'Matang (Tanawat Tangsupwattana)'},
    { id: 17, name: 'Pingping (Narathorn Janvipast)'},
    { id: 18, name: 'Kenta (Wuttipat Tubsarn)'},
    { id: 19, name: 'Temim (Phuchanut Saengrayub)'},
    { id: 20, name: 'Takky (Tatchakorn Sattawongsakul)'},
    { id: 21, name: 'Tigger (Totchakorn Sattawongsakul)'},
    { id: 22, name: 'L (Allen) (Allen Jarnyaharn)'},
    { id: 23, name: 'Parm (Thaiket Laoprapassakul) Prompt (Prompatchara Nitiraksa)'},
    { id: 24, name: 'Ren (Tarit Janjaemjaroon)'},
    { id: 25, name: 'Miranda (Miranda Chen)'},
    { id: 26, name: 'Gus (Akaradej Imarom)'},
    { id: 27, name: 'Eton (Chavin Rattanasophon)'},
    { id: 28, name: 'Winwin (Thanaphat ketthanasitthi)'},
    { id: 29, name: 'Ran (Paramita Chatthong) Ray (Poonchida Chatthong)'},
    { id: 30, name: 'Rak (Weeralak saelim)'},
    { id: 31, name: 'Captain (Suttidol Songsripipat)'},
    { id: 32, name: 'Khonkwan (Benjanut Srisuk)'},
    { id: 33, name: 'liangliang (Warinthon Limsathiranun)'},
    { id: 34, name: 'Thun (Thun Iamthongthong)'}
    ];

    const dict = {
      th: {
        title: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö", subtitle: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ 3 ‡∏ó‡πà‡∏≤‡∏ô",
        btn: "‡∏™‡πà‡∏á‡πÇ‡∏´‡∏ß‡∏ï", loading: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...", hint: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 3 ‡∏Ñ‡∏ô",
        successT: "‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", successD: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet ‡πÅ‡∏•‡πâ‡∏ß",
        alreadyT: "‡πÇ‡∏´‡∏ß‡∏ï‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß", alreadyD: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß",
        lang: "English", emailErr: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"
      },
      en: {
        title: "Choose your preferred presentation.", subtitle: "Please enter your email address and select 3 presenters.",
        btn: "Submit Vote", loading: "Saving to Sheets...", hint: "Please select exactly 3",
        successT: "Thank You!", successD: "Your vote has been recorded successfully",
        alreadyT: "Already Voted", alreadyD: "This device/email has already been used",
        lang: "‡πÑ‡∏ó‡∏¢", emailErr: "Invalid Email Address"
      }
    };

    let selected = new Set();
    let lang = 'th';

    function init() {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÇ‡∏´‡∏ß‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
      if (localStorage.getItem('voted')) {
        showScreen('already');
        return;
      }
      renderCandidates();
      updateUI();
    }

   function renderCandidates() {
    const grid = document.getElementById('grid-candidates');
    grid.innerHTML = candidates.map(c => {
      // ‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á
      const displayName = c.name.replace(/\) /g, ')<br>'); 

      return `
        <div class="candidate-card bg-white/10 p-4 rounded-xl text-center shadow-md flex items-center justify-center min-h-[80px]" id="c-${c.id}" onclick="selectCandidate(${c.id})">
          <div class="font-semibold text-white leading-tight text-base">${displayName}</div>
        </div>
      `;
    }).join('');
  }

    function selectCandidate(id) {
      if (selected.has(id)) {
        selected.delete(id);
      } else {
        if (selected.size >= 3) return; // ‡∏•‡πá‡∏≠‡∏Ñ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà 3 ‡∏Ñ‡∏ô
        selected.add(id);
      }
      
      // Update Class
      document.querySelectorAll('.candidate-card').forEach(el => el.classList.remove('selected'));
      selected.forEach(sid => document.getElementById(`c-${sid}`).classList.add('selected'));
      
      validate();
    }

    function validate() {
      const email = document.getElementById('input-email').value;
      const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      const btn = document.getElementById('btn-submit');
      const countDisplay = document.getElementById('count-display');
      
      countDisplay.innerText = selected.size;

      if (selected.size === 3 && isValidEmail) {
        btn.disabled = false;
        document.getElementById('txt-hint').innerText = "";
      } else {
        btn.disabled = true;
        document.getElementById('txt-hint').innerText = selected.size < 3 ? dict[lang].hint : "";
      }
    }

    async function submitData() {
      const email = document.getElementById('input-email').value.trim();
      const names = Array.from(selected).map(id => candidates.find(c => c.id === id).name);
      
      showScreen('loading');

      const payload = {
        email: email,
        votes: names,
        device_id: 'ID-' + Math.random().toString(36).substr(2, 9)
      };

      try {
        // ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö POST ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ fetch
        // ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î no-cors ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π JSON response ‡∏ó‡∏µ‡πà Apps Script ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify(payload)
        });
        
        const resData = await response.json();

        if (resData.result === "success") {
          localStorage.setItem('voted', 'true');
          document.getElementById('display-email').innerText = email;
          showScreen('success');
        } else if (resData.message === "duplicate") {
          showScreen('already');
        } else {
          alert("Error: " + resData.message);
          showScreen('voting');
        }
      } catch (err) {
        // ‡∏Å‡∏£‡∏ì‡∏µ Error ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á CORS (‡∏ã‡∏∂‡πà‡∏á‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢) ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ Image Beacon ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ Sheet ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏´‡∏°
        // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏ã‡πá‡∏ï Google Script ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
        console.error(err);
        localStorage.setItem('voted', 'true'); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
        showScreen('success');
      }
    }

    function showScreen(id) {
      document.querySelectorAll('#app > div[id^="screen-"]').forEach(s => s.classList.add('hidden'));
      document.getElementById('screen-' + id).classList.remove('hidden');
    }

    function toggleLang() {
      lang = lang === 'th' ? 'en' : 'th';
      document.getElementById('txt-title').innerText = dict[lang].title;
      document.getElementById('txt-subtitle').innerText = dict[lang].subtitle;
      document.getElementById('txt-btn-submit').innerText = dict[lang].btn;
      document.getElementById('txt-loading').innerText = dict[lang].loading;
      document.getElementById('lang-btn-text').innerText = dict[lang].lang;
      validate();
    }

    init();
  </script>
</body>
</html>
